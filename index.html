<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Himalayan Beverages ERP v1.0 | Cloud Integrated</title>
    
    <!-- 
      Himalayan Beverages ERP - Single File Solution
      Technology: HTML5, CSS3, Vanilla ES6 JavaScript
      Modules Included:
      1. Sales & CRM
      2. Distribution Management
      3. Inventory & WMS
      4. Order Fulfillment
      5. Accounting & Invoicing
      6. Reporting
      7. Google Drive Sync Adapter
    -->

    <style>
        /* =========================================
           1. CSS VARIABLES & RESET
           ========================================= */
        :root {
            /* Color Palette */
            --primary: #1976D2;
            --primary-dark: #1565C0;
            --primary-light: #BBDEFB;
            --accent: #FF6F00; /* Amber for Call to Actions */
            
            --bg-body: #F4F6F8;
            --bg-surface: #FFFFFF;
            --bg-sidebar: #1C2331;
            
            --text-main: #263238;
            --text-muted: #607D8B;
            --text-light: #ECEFF1;

            --border-color: #E0E0E0;
            
            /* Status Colors */
            --success: #2E7D32;
            --warning: #F9A825;
            --danger: #C62828;
            --info: #0277BD;

            /* Spacing */
            --gap-sm: 8px;
            --gap-md: 16px;
            --gap-lg: 24px;
            --gap-xl: 32px;

            /* Transitions */
            --transition-speed: 0.25s;

            /* Sidebar */
            --sidebar-width: 260px;
            --header-height: 64px;
        }

        * {
            box-sizing: border-box;
            outline: none;
        }

        html, body {
            margin: 0;
            padding: 0;
            height: 100vh;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            font-size: 14px;
            background-color: var(--bg-body);
            color: var(--text-main);
            overflow: hidden; /* App-like feel */
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.05);
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(0,0,0,0.2);
            border-radius: 4px;
        }

        /* =========================================
           2. LAYOUT COMPOSITION
           ========================================= */
        #app {
            display: flex;
            height: 100%;
        }

        /* Sidebar Styling */
        aside {
            width: var(--sidebar-width);
            background-color: var(--bg-sidebar);
            color: var(--text-light);
            display: flex;
            flex-direction: column;
            box-shadow: 4px 0 10px rgba(0,0,0,0.1);
            z-index: 10;
            transition: width var(--transition-speed);
        }

        .brand-block {
            height: var(--header-height);
            display: flex;
            align-items: center;
            padding: 0 var(--gap-md);
            background: rgba(255,255,255,0.05);
            font-size: 1.1rem;
            font-weight: 600;
            letter-spacing: 0.5px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .brand-icon {
            width: 32px;
            height: 32px;
            margin-right: 12px;
            background: var(--primary);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
        }

        nav {
            flex: 1;
            overflow-y: auto;
            padding-top: var(--gap-md);
        }

        .nav-group-title {
            padding: var(--gap-sm) var(--gap-md);
            font-size: 0.75rem;
            text-transform: uppercase;
            color: #78909C;
            margin-top: var(--gap-sm);
        }

        .nav-item {
            padding: 12px var(--gap-md);
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: all 0.2s;
            border-left: 3px solid transparent;
            color: #CFD8DC;
        }

        .nav-item:hover {
            background-color: rgba(255,255,255,0.05);
            color: white;
        }

        .nav-item.active {
            background-color: rgba(25, 118, 210, 0.2);
            border-left-color: var(--primary);
            color: var(--primary-light);
        }

        .nav-item svg {
            margin-right: 12px;
            fill: currentColor;
            width: 18px;
            height: 18px;
            opacity: 0.8;
        }

        .sync-status-bar {
            padding: var(--gap-md);
            background: rgba(0,0,0,0.2);
            font-size: 0.8rem;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .sync-status-text {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .drive-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #757575; /* Inactive */
            transition: background 0.3s;
        }
        .drive-indicator.connected { background-color: var(--success); }
        .drive-indicator.syncing { background-color: var(--warning); animation: blink 1s infinite; }

        /* Main Content Styling */
        main {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: var(--bg-body);
            position: relative;
        }

        header.top-bar {
            height: var(--header-height);
            background: var(--bg-surface);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 var(--gap-lg);
            border-bottom: 1px solid var(--border-color);
        }

        .page-title h2 { margin: 0; font-size: 1.25rem; font-weight: 500; }
        .breadcrumbs { font-size: 0.8rem; color: var(--text-muted); }

        .header-actions {
            display: flex;
            gap: var(--gap-md);
            align-items: center;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }
        .avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.9rem;
        }

        .view-port {
            flex: 1;
            overflow-y: auto;
            padding: var(--gap-lg);
            position: relative;
        }

        /* =========================================
           3. UI COMPONENTS
           ========================================= */
        
        /* Buttons */
        .btn {
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-dark); box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .btn-secondary { background: white; border: 1px solid var(--border-color); color: var(--text-main); }
        .btn-secondary:hover { background: #f5f5f5; }
        .btn-success { background: var(--success); color: white; }
        .btn-danger { background: white; border: 1px solid var(--danger); color: var(--danger); }
        .btn-danger:hover { background: #ffebee; }
        
        /* Cards */
        .card {
            background: var(--bg-surface);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            padding: var(--gap-lg);
            margin-bottom: var(--gap-lg);
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
        }
        .card h3 { margin-top: 0; color: var(--text-muted); font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.5px; }

        /* Grid System */
        .row { display: flex; flex-wrap: wrap; margin: -10px; }
        .col { padding: 10px; flex: 1; min-width: 250px; }
        .col-3 { flex-basis: 25%; }
        .col-4 { flex-basis: 33.33%; }
        .col-6 { flex-basis: 50%; }
        .col-8 { flex-basis: 66.66%; }
        .col-12 { flex-basis: 100%; }

        /* Forms */
        .form-group { margin-bottom: 15px; }
        .form-label { display: block; margin-bottom: 5px; font-weight: 500; font-size: 0.9rem; color: #455A64; }
        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 0.95rem;
            transition: border-color 0.2s;
        }
        .form-control:focus { border-color: var(--primary); box-shadow: 0 0 0 2px var(--primary-light); }
        select.form-control { background-color: white; }

        /* Tables */
        .data-table-container {
            width: 100%;
            overflow-x: auto;
            border: 1px solid var(--border-color);
            border-radius: 6px;
        }
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95rem;
        }
        .data-table th {
            text-align: left;
            padding: 12px 16px;
            background: #FAFAFA;
            border-bottom: 2px solid var(--border-color);
            font-weight: 600;
            color: var(--text-muted);
        }
        .data-table td {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-color);
        }
        .data-table tr:last-child td { border-bottom: none; }
        .data-table tr:hover td { background-color: #F8FDFF; }
        
        .badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: bold;
            display: inline-block;
        }
        .badge-success { background: #E8F5E9; color: #2E7d32; }
        .badge-warning { background: #FFF8E1; color: #F57F17; }
        .badge-danger { background: #FFEBEE; color: #C62828; }
        .badge-info { background: #E1F5FE; color: #0277BD; }

        /* KPI Dashboard Stats */
        .kpi-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: var(--gap-lg);
            margin-bottom: var(--gap-lg);
        }
        .kpi-card {
            background: white;
            padding: var(--gap-md);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            border-left: 4px solid var(--primary);
            position: relative;
        }
        .kpi-val { font-size: 2rem; font-weight: 700; color: var(--text-main); margin: 8px 0; }
        .kpi-label { font-size: 0.85rem; color: var(--text-muted); text-transform: uppercase; }

        /* Modal/Toast */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex; justify-content: center; align-items: center;
            z-index: 100;
            opacity: 0; pointer-events: none; transition: 0.2s;
        }
        .modal-overlay.open { opacity: 1; pointer-events: all; }
        .modal {
            background: white; width: 500px; max-width: 90%;
            border-radius: 8px; box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            padding: var(--gap-lg); transform: translateY(20px); transition: 0.3s;
        }
        .modal-overlay.open .modal { transform: translateY(0); }
        .modal-header { font-size: 1.2rem; font-weight: bold; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px;}
        .modal-footer { margin-top: 20px; display: flex; justify-content: flex-end; gap: 10px; }

        /* Utilities */
        .hidden { display: none !important; }
        .text-right { text-align: right; }
        .flex-between { display: flex; justify-content: space-between; align-items: center; }

        /* Print Specific */
        @media print {
            aside, header, .header-actions { display: none; }
            #app, main, .view-port { height: auto; overflow: visible; display: block; }
            .no-print { display: none !important; }
            .card { border: none; box-shadow: none; padding: 0; }
            body { background: white; -webkit-print-color-adjust: exact; }
        }

        /* Animations */
        @keyframes blink { 0% {opacity:1;} 50% {opacity:0.4;} 100% {opacity:1;} }
        @keyframes fadeIn { from {opacity:0; transform: translateY(10px);} to {opacity:1; transform:translateY(0);} }
        .fade-in { animation: fadeIn 0.4s ease-out; }

    </style>
</head>
<body>

    <div id="app">
        <!-- Sidebar Navigation -->
        <aside>
            <div class="brand-block">
                <div class="brand-icon">H</div>
                <span>HimalayanERP</span>
            </div>
            
            <nav id="main-nav">
                <div class="nav-group-title">Main</div>
                <div class="nav-item active" data-target="dashboard">
                    <svg viewBox="0 0 24 24"><path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/></svg>
                    Dashboard
                </div>
                
                <div class="nav-group-title">CRM & Sales</div>
                <div class="nav-item" data-target="crm-list">
                    <svg viewBox="0 0 24 24"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg>
                    Customers / CRM
                </div>
                <div class="nav-item" data-target="orders">
                    <svg viewBox="0 0 24 24"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/></svg>
                    Sales Orders
                </div>
                
                <div class="nav-group-title">Logistics</div>
                <div class="nav-item" data-target="inventory">
                    <svg viewBox="0 0 24 24"><path d="M20 13H4c-.55 0-1 .45-1 1v6c0 .55.45 1 1 1h16c.55 0 1-.45 1-1v-6c0-.55-.45-1-1-1zM7 19c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zM20 3H4c-.55 0-1 .45-1 1v6c0 .55.45 1 1 1h16c.55 0 1-.45 1-1V4c0-.55-.45-1-1-1zM7 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/></svg>
                    Inventory
                </div>
                <div class="nav-item" data-target="routes">
                    <svg viewBox="0 0 24 24"><path d="M20.5 11H19V7c0-1.1-.9-2-2-2h-4c0-1.66-1.34-3-3-3S7 3.34 7 5H3c-1.1 0-2 .9-2 2v8h2c0 1.66 1.34 3 3 3s3-1.34 3-3h8c0 1.66 1.34 3 3 3s3-1.34 3-3h2v-5l-1.5-2zM10 5c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1z"/></svg>
                    Distribution & Route
                </div>

                <div class="nav-group-title">Finance</div>
                <div class="nav-item" data-target="accounts">
                    <svg viewBox="0 0 24 24"><path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"/></svg>
                    Invoices & Ledger
                </div>

                <div class="nav-group-title">System</div>
                <div class="nav-item" data-target="settings">
                    <svg viewBox="0 0 24 24"><path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"/></svg>
                    Settings & G-Drive
                </div>
            </nav>

            <div class="sync-status-bar">
                <div class="sync-status-text">
                    <span>Google Drive</span>
                    <div id="drive-led" class="drive-indicator"></div>
                </div>
                <div style="font-size:0.75rem; color:#90A4AE" id="last-sync-time">Not connected</div>
            </div>
        </aside>

        <!-- Main Workspace -->
        <main>
            <!-- Top Header -->
            <header class="top-bar">
                <div class="header-info">
                    <div class="breadcrumbs">Home &rsaquo; <span id="bread-active">Dashboard</span></div>
                    <div class="page-title"><h2 id="page-title-text">Operational Overview</h2></div>
                </div>
                
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="System.Action.quickOrder()">+ New Order</button>
                    <div class="user-profile">
                        <span>Admin User</span>
                        <div class="avatar">A</div>
                    </div>
                </div>
            </header>

            <!-- Scrollable View Port -->
            <div class="view-port">
                
                <!-- MODULE 1: DASHBOARD -->
                <section id="view-dashboard" class="module-view fade-in">
                    <!-- KPI Cards -->
                    <div class="kpi-container">
                        <div class="kpi-card" style="border-left-color: var(--primary);">
                            <div class="kpi-label">Sales (Today)</div>
                            <div class="kpi-val" id="kpi-today-sales">₹ 0.00</div>
                        </div>
                        <div class="kpi-card" style="border-left-color: var(--success);">
                            <div class="kpi-label">Active Orders</div>
                            <div class="kpi-val" id="kpi-active-orders">0</div>
                        </div>
                        <div class="kpi-card" style="border-left-color: var(--warning);">
                            <div class="kpi-label">Inventory Alerts</div>
                            <div class="kpi-val" id="kpi-inv-alerts">0</div>
                        </div>
                        <div class="kpi-card" style="border-left-color: var(--info);">
                            <div class="kpi-label">Vehicles On Route</div>
                            <div class="kpi-val" id="kpi-routes">2</div>
                        </div>
                    </div>

                    <!-- Layout: Left (Chart place), Right (Recent activity) -->
                    <div class="row">
                        <div class="col col-8">
                            <div class="card" style="min-height: 400px;">
                                <h3>Operations Performance</h3>
                                <div style="height:350px; background: #fafafa; border:1px dashed #ccc; display:flex; align-items:center; justify-content:center; border-radius:4px; margin-top:10px;">
                                    <div style="text-align:center; color:#ccc;">
                                        [Interactive Revenue Chart Placeholder]<br>
                                        <small>(Implemented via Chart.js in production)</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col col-4">
                            <div class="card" style="min-height: 400px;">
                                <div class="flex-between">
                                    <h3>Recent Notifications</h3>
                                    <small style="cursor:pointer; color:var(--primary)">Clear All</small>
                                </div>
                                <ul style="list-style:none; padding:0; margin-top:15px; color:#555;" id="dashboard-notifs">
                                    <!-- Populated by JS -->
                                </ul>
                            </div>
                        </div>
                    </div>
                </section>


                <!-- MODULE 2: CRM (1.1) -->
                <section id="view-crm-list" class="module-view hidden">
                    <div class="card">
                        <div class="flex-between" style="margin-bottom: 20px;">
                            <h3>Customer Database</h3>
                            <button class="btn btn-primary" onclick="CRM.openModal()">+ Add Customer</button>
                        </div>
                        
                        <div style="margin-bottom:15px; display:flex; gap:10px;">
                            <input type="text" id="crm-search" placeholder="Search by name, phone or GST..." class="form-control" style="max-width:300px">
                            <select class="form-control" style="width:150px">
                                <option>All Types</option>
                                <option>Retailer</option>
                                <option>Distributor</option>
                                <option>HoReCa</option>
                            </select>
                        </div>

                        <div class="data-table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Customer Name</th>
                                        <th>Type</th>
                                        <th>Location/Region</th>
                                        <th>Balance</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="crm-table-body">
                                    <!-- Rendered JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>


                <!-- MODULE 3: INVENTORY (1.3) -->
                <section id="view-inventory" class="module-view hidden">
                    <div class="row">
                        <div class="col col-8">
                            <div class="card">
                                <h3>Stock Level Overview</h3>
                                <div class="data-table-container" style="margin-top:10px;">
                                    <table class="data-table">
                                        <thead>
                                            <tr>
                                                <th>SKU Code</th>
                                                <th>Product Name</th>
                                                <th>Size</th>
                                                <th>Central WH</th>
                                                <th>Vans</th>
                                                <th>Status</th>
                                            </tr>
                                        </thead>
                                        <tbody id="inventory-table-body"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="col col-4">
                            <div class="card">
                                <h3>Actions</h3>
                                <button class="btn btn-secondary" style="width:100%; margin-bottom:10px;">Stock Transfer Request</button>
                                <button class="btn btn-secondary" style="width:100%; margin-bottom:10px;">Adjust/Cycle Count</button>
                                <hr>
                                <h3>Expiry Watchlist</h3>
                                <ul style="font-size:0.9rem; padding-left:20px; color:#D32F2F">
                                    <li>Batch B2901 - Freskey 200ml (Exp: 5 days)</li>
                                    <li>Batch B2888 - Freskey 500ml (Exp: 12 days)</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- MODULE 4: ORDERS (1.5) -->
                <section id="view-orders" class="module-view hidden">
                    <div class="card">
                         <div class="flex-between" style="margin-bottom:15px;">
                            <h3>Sales Orders Management</h3>
                            <button class="btn btn-primary" onclick="System.Action.quickOrder()">+ Create Order</button>
                         </div>
                         <div class="data-table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Order #</th>
                                        <th>Date</th>
                                        <th>Customer</th>
                                        <th>Total (INR)</th>
                                        <th>Payment</th>
                                        <th>Fulfillment</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="orders-table-body">
                                </tbody>
                            </table>
                         </div>
                    </div>
                </section>
                
                <!-- MODULE 5: ACCOUNTS (1.7) -->
                <section id="view-accounts" class="module-view hidden">
                    <div class="row">
                        <div class="col col-12">
                             <div class="card">
                                <h3>Invoices & Collections</h3>
                                <div class="data-table-container">
                                    <table class="data-table">
                                        <thead>
                                            <tr>
                                                <th>Inv #</th>
                                                <th>Linked Order</th>
                                                <th>Customer</th>
                                                <th>Amount</th>
                                                <th>Due Date</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="invoice-table-body"></tbody>
                                    </table>
                                </div>
                             </div>
                        </div>
                    </div>
                </section>

                <!-- MODULE 6: ROUTES (1.2) -->
                <section id="view-routes" class="module-view hidden">
                     <div class="row">
                         <div class="col col-4">
                            <div class="card">
                                <h3>Route Planning</h3>
                                <div class="form-group">
                                    <label class="form-label">Select Date</label>
                                    <input type="date" class="form-control" value="2025-10-12">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Available Vehicles</label>
                                    <div style="background:#f9f9f9; border:1px solid #eee; padding:10px; border-radius:4px;">
                                        <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                                            <span><strong>MH-12-GH-4455</strong></span>
                                            <span class="badge badge-success">Idle</span>
                                        </div>
                                        <small>Driver: Raju Singh | Cap: 150 crates</small>
                                        <div style="margin-top:5px; height:6px; background:#ddd; width:100%;"><div style="width:0; background:var(--primary); height:6px;"></div></div>
                                    </div>
                                    <div style="background:#f9f9f9; border:1px solid #eee; padding:10px; border-radius:4px; margin-top:10px;">
                                        <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                                            <span><strong>MH-14-DD-9999</strong></span>
                                            <span class="badge badge-warning">On Route</span>
                                        </div>
                                        <small>Driver: Amit Kumar | Cap: 200 crates</small>
                                        <div style="margin-top:5px; height:6px; background:#ddd; width:100%;"><div style="width:65%; background:var(--primary); height:6px;"></div></div>
                                    </div>
                                </div>
                                <button class="btn btn-primary" style="width:100%">Auto-Generate Manifest</button>
                            </div>
                         </div>
                         <div class="col col-8">
                             <div class="card">
                                 <h3>Route Map Simulation</h3>
                                 <div style="background: #E0E0E0; height:400px; display:flex; align-items:center; justify-content:center; color:#555;">
                                     [Google Maps Integration View] <br>
                                     Showing 24 Delivery Stops
                                 </div>
                             </div>
                         </div>
                     </div>
                </section>

                <!-- SETTINGS & DRIVE -->
                <section id="view-settings" class="module-view hidden">
                    <div class="card">
                        <h3>System Configuration</h3>
                        <div class="form-group" style="max-width:400px">
                            <label class="form-label">Company Name</label>
                            <input type="text" class="form-control" value="Himalayan Beverages Ltd">
                        </div>
                    </div>
                    
                    <div class="card" style="border-left: 4px solid #34A853;">
                        <div class="flex-between">
                            <h3>Google Drive Cloud Integration</h3>
                            <button id="btn-drive-auth" class="btn btn-secondary" onclick="DriveAPI.initAuth()">Connect Account</button>
                        </div>
                        <p style="color:#666; font-size:0.9rem; margin: 15px 0;">
                            Backup your database, export PDF invoices, and sync manifests to Google Sheets drivers.
                        </p>
                        
                        <div style="background:#f5f5f5; padding:15px; border-radius:4px; font-family:monospace; font-size:0.8rem; height:150px; overflow-y:auto;" id="drive-logs">
                            [System] Ready for Drive connection...
                        </div>
                        <br>
                        <button class="btn btn-primary" onclick="DriveAPI.uploadDatabase()">Force Backup Now</button>
                    </div>
                </section>
                
            </div>
        </main>
    </div>

    <!-- ===================== MODALS ===================== -->
    
    <!-- Customer Modal -->
    <div class="modal-overlay" id="modal-customer">
        <div class="modal">
            <div class="modal-header">Add New Customer</div>
            <form id="form-customer">
                <div class="form-group">
                    <label class="form-label">Business Name</label>
                    <input type="text" name="name" class="form-control" required>
                </div>
                <div class="row">
                    <div class="col"><div class="form-group"><label class="form-label">Type</label><select name="type" class="form-control"><option>Retailer</option><option>Distributor</option></select></div></div>
                    <div class="col"><div class="form-group"><label class="form-label">GSTIN</label><input type="text" name="gst" class="form-control"></div></div>
                </div>
                <div class="form-group">
                    <label class="form-label">Address / Zone</label>
                    <input type="text" name="addr" class="form-control">
                </div>
                <div class="row">
                    <div class="col"><div class="form-group"><label class="form-label">Contact Person</label><input type="text" name="poc" class="form-control"></div></div>
                    <div class="col"><div class="form-group"><label class="form-label">Phone</label><input type="text" name="phone" class="form-control"></div></div>
                </div>
            </form>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="CRM.closeModal()">Cancel</button>
                <button class="btn btn-primary" onclick="CRM.save()">Save Customer</button>
            </div>
        </div>
    </div>

    <!-- Order Modal -->
    <div class="modal-overlay" id="modal-order">
        <div class="modal" style="width: 700px;">
            <div class="modal-header">Create Sales Order</div>
            <div style="display:flex; flex-direction:column; height: 400px;">
                <div class="row">
                    <div class="col">
                        <label class="form-label">Select Customer</label>
                        <select id="ord-cust-select" class="form-control"></select>
                    </div>
                    <div class="col">
                        <label class="form-label">Expected Delivery</label>
                        <input type="date" class="form-control" id="ord-date">
                    </div>
                </div>
                <div style="margin:20px 0; border:1px solid #eee; flex:1; padding:10px; overflow-y:auto;">
                    <table class="data-table" id="ord-lines-table">
                        <thead><tr><th>SKU</th><th>Rate</th><th>Qty (Cases)</th><th>Subtotal</th><th>X</th></tr></thead>
                        <tbody></tbody>
                    </table>
                    <div style="margin-top:10px;">
                        <button class="btn btn-secondary" style="font-size:0.8rem" onclick="Order.addLine()">+ Add Product</button>
                    </div>
                </div>
                <div class="text-right" style="font-size:1.1rem; font-weight:bold; margin-bottom:15px;">
                    Total: ₹<span id="ord-grand-total">0.00</span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="document.getElementById('modal-order').classList.remove('open')">Close</button>
                <button class="btn btn-primary" onclick="Order.save()">Confirm Order</button>
            </div>
        </div>
    </div>

    <!-- ===================== JAVASCRIPT ===================== -->
    <script>
        /* =========================================
           DATA LAYER (IN-MEMORY MOCK DB)
           ========================================= */
        const DB = {
            products: [
                { id: "SKU-200", name: "Freskey 200ml", unit: "Case (24)", price: 480, stock_wh: 500, stock_van: 40 },
                { id: "SKU-500", name: "Freskey 500ml", unit: "Case (12)", price: 360, stock_wh: 300, stock_van: 20 },
                { id: "SKU-1000", name: "Freskey 1000ml", unit: "Case (6)", price: 300, stock_wh: 150, stock_van: 5 }
            ],
            customers: [
                { id: 101, name: "Sai Provisions", type: "Retailer", contact: "Rajesh", phone: "9876543210", region: "North Zone", gst: "27AAAC12341Z1", balance: 1200 },
                { id: 102, name: "Hotel Grand Blue", type: "HoReCa", contact: "Manager", phone: "9988776655", region: "City Center", gst: "27AAAC12341Z2", balance: 0 },
                { id: 103, name: "Laxmi Distributors", type: "Distributor", contact: "Vikas", phone: "9123456789", region: "West Dist", gst: "27AAAC12341Z3", balance: 50000 },
                { id: 104, name: "Tech Events Inc", type: "Event", contact: "Coordinator", phone: "8888888888", region: "Expo Ground", gst: "Unregistered", balance: 0 },
            ],
            orders: [], // Will generate samples on load
            invoices: [],
            activities: [
                { text: "System Rebooted", time: "08:00 AM" },
                { text: "Stock Update: 100 cases Freskey-200 added to Central", time: "09:30 AM" }
            ]
        };

        /* =========================================
           CORE LOGIC / CONTROLLERS
           ========================================= */

        const Utils = {
            fmtCurrency: (amount) => "₹ " + amount.toFixed(2),
            idGen: () => Math.floor(Math.random() * 1000000).toString(16),
            toast: (msg) => {
                alert(msg); // Simplifying Toast to alert for brevity
            },
            log: (msg) => {
                const list = document.getElementById('dashboard-notifs');
                if(!list) return;
                const li = document.createElement('li');
                li.style.borderBottom = "1px solid #eee";
                li.style.padding = "8px 0";
                li.innerHTML = `<strong>New:</strong> ${msg} <span style="float:right; font-size:0.75rem; color:#aaa">Just now</span>`;
                list.prepend(li);
                DB.activities.unshift({text:msg, time:"Now"});
            }
        };

        // Navigation
        const Router = {
            init: () => {
                const links = document.querySelectorAll('.nav-item');
                links.forEach(link => {
                    link.addEventListener('click', (e) => {
                        const target = link.dataset.target;
                        Router.navigate(target);
                    });
                });
            },
            navigate: (viewId) => {
                // Update Sidebar
                document.querySelectorAll('.nav-item').forEach(l => l.classList.remove('active'));
                const activeLink = document.querySelector(`.nav-item[data-target="${viewId}"]`);
                if(activeLink) activeLink.classList.add('active');

                // Hide all views
                document.querySelectorAll('.module-view').forEach(v => {
                    v.classList.add('hidden');
                    v.classList.remove('fade-in');
                });
                
                // Show target
                const section = document.getElementById(`view-${viewId}`);
                if(section) {
                    section.classList.remove('hidden');
                    section.classList.add('fade-in');
                    
                    // Trigger Data Refresh Specific to View
                    if(viewId === 'crm-list') CRM.render();
                    if(viewId === 'inventory') Inventory.render();
                    if(viewId === 'orders') Order.renderHistory();
                    if(viewId === 'accounts') Accounts.render();
                }

                // Update Breadcrumb
                document.getElementById('bread-active').innerText = activeLink ? activeLink.textContent.trim() : viewId;
                const titles = {
                    'dashboard': 'Operational Overview',
                    'crm-list': 'Customer Relationship Management',
                    'orders': 'Sales Order Processing',
                    'inventory': 'Stock & Warehouse',
                    'accounts': 'Invoicing & Ledgers',
                    'settings': 'System Settings'
                };
                document.getElementById('page-title-text').innerText = titles[viewId] || 'Himalayan ERP';
            }
        };

        // CRM Module
        const CRM = {
            render: () => {
                const tbody = document.getElementById('crm-table-body');
                tbody.innerHTML = '';
                DB.customers.forEach(c => {
                    const row = `<tr>
                        <td>#${c.id}</td>
                        <td><b>${c.name}</b><div style="font-size:0.8rem;color:#777">${c.contact} | ${c.phone}</div></td>
                        <td><span class="badge badge-info">${c.type}</span></td>
                        <td>${c.region}</td>
                        <td class="${c.balance > 0 ? 'text-danger':''}">${Utils.fmtCurrency(c.balance)}</td>
                        <td><button class="btn btn-sm btn-secondary">Edit</button></td>
                    </tr>`;
                    tbody.insertAdjacentHTML('beforeend', row);
                });
            },
            openModal: () => document.getElementById('modal-customer').classList.add('open'),
            closeModal: () => document.getElementById('modal-customer').classList.remove('open'),
            save: () => {
                const form = document.getElementById('form-customer');
                const data = {
                    id: 100 + DB.customers.length + 1,
                    name: form.querySelector('[name=name]').value,
                    type: form.querySelector('[name=type]').value,
                    gst: form.querySelector('[name=gst]').value,
                    region: form.querySelector('[name=addr]').value,
                    contact: form.querySelector('[name=poc]').value,
                    phone: form.querySelector('[name=phone]').value,
                    balance: 0
                };
                DB.customers.push(data);
                CRM.render();
                CRM.closeModal();
                Utils.toast("Customer Added Successfully");
                Utils.log(`New Customer registered: ${data.name}`);
            }
        };

        // Inventory Module
        const Inventory = {
            render: () => {
                const tbody = document.getElementById('inventory-table-body');
                tbody.innerHTML = '';
                DB.products.forEach(p => {
                    const total = p.stock_wh + p.stock_van;
                    const status = total < 100 ? `<span class="badge badge-danger">Low Stock</span>` : `<span class="badge badge-success">Good</span>`;
                    const row = `<tr>
                        <td>${p.id}</td>
                        <td>${p.name}</td>
                        <td>${p.unit}</td>
                        <td>${p.stock_wh}</td>
                        <td>${p.stock_van}</td>
                        <td>${status}</td>
                    </tr>`;
                    tbody.insertAdjacentHTML('beforeend', row);
                });
                
                // Update KPI Dashboard
                document.getElementById('kpi-inv-alerts').innerText = DB.products.filter(p => (p.stock_wh + p.stock_van) < 100).length;
            }
        };

        // Order System
        const Order = {
            currentLines: [],
            renderHistory: () => {
                const tbody = document.getElementById('orders-table-body');
                tbody.innerHTML = '';
                DB.orders.sort((a,b) => b.id - a.id).forEach(o => {
                    const cust = DB.customers.find(c => c.id == o.custId);
                    const statusBadge = o.status === 'Paid' ? 'badge-success' : 'badge-warning';
                    const row = `<tr>
                        <td><a href="#">ORD-${o.id}</a></td>
                        <td>${o.date}</td>
                        <td>${cust ? cust.name : 'Unknown'}</td>
                        <td>${Utils.fmtCurrency(o.total)}</td>
                        <td><span class="badge ${statusBadge}">${o.status}</span></td>
                        <td>${o.fulfilled ? 'Delivered' : 'Pending'}</td>
                        <td><button class="btn btn-sm btn-secondary" onclick="DriveAPI.generatePDF('${o.id}')">PDF</button></td>
                    </tr>`;
                    tbody.insertAdjacentHTML('beforeend', row);
                });
                
                // Dashboard Update
                const today = new Date().toISOString().split('T')[0];
                const todayOrders = DB.orders.filter(o => o.date === today);
                document.getElementById('kpi-today-sales').innerText = Utils.fmtCurrency(todayOrders.reduce((sum, o)=>sum+o.total, 0));
                document.getElementById('kpi-active-orders').innerText = DB.orders.filter(o => o.status === 'Pending' || o.status === 'Dispatched').length;
            },
            
            // Order Modal Functions
            populateProducts: () => {
                 // Nothing specific needed as adding lines uses hardcoded list logic for simplicity below
            },
            populateCust: () => {
                const sel = document.getElementById('ord-cust-select');
                sel.innerHTML = '';
                DB.customers.forEach(c => {
                    const opt = document.createElement('option');
                    opt.value = c.id;
                    opt.innerText = c.name + (c.type === 'Distributor' ? ' (Dist)' : '');
                    sel.appendChild(opt);
                });
            },
            addLine: () => {
                const tbody = document.getElementById('ord-lines-table').querySelector('tbody');
                const tr = document.createElement('tr');
                // Select Box construction
                let options = DB.products.map(p => `<option value="${p.id}" data-price="${p.price}">${p.name}</option>`).join('');
                
                tr.innerHTML = `
                    <td><select class="form-control prod-select">${options}</select></td>
                    <td class="rate-val">₹ ${DB.products[0].price}</td>
                    <td><input type="number" value="1" min="1" class="form-control qty-input" style="width:80px"></td>
                    <td class="subtotal">₹ ${DB.products[0].price}</td>
                    <td><button class="btn btn-danger btn-sm" onclick="this.closest('tr').remove(); Order.calcTotal()">x</button></td>
                `;
                tbody.appendChild(tr);

                // Add Listeners
                const select = tr.querySelector('.prod-select');
                const qty = tr.querySelector('.qty-input');
                
                const update = () => {
                    const price = parseFloat(select.options[select.selectedIndex].dataset.price);
                    const q = parseInt(qty.value);
                    tr.querySelector('.rate-val').innerText = `₹ ${price}`;
                    tr.querySelector('.subtotal').innerText = `₹ ${price * q}`;
                    Order.calcTotal();
                };
                
                select.addEventListener('change', update);
                qty.addEventListener('input', update);
                Order.calcTotal();
            },
            calcTotal: () => {
                const rows = document.querySelectorAll('#ord-lines-table tbody tr');
                let grand = 0;
                rows.forEach(r => {
                     const txt = r.querySelector('.subtotal').innerText.replace('₹','').trim();
                     grand += parseFloat(txt);
                });
                document.getElementById('ord-grand-total').innerText = grand.toFixed(2);
            },
            save: () => {
                const custId = document.getElementById('ord-cust-select').value;
                const grand = document.getElementById('ord-grand-total').innerText;
                const newOrder = {
                    id: Math.floor(Math.random()*9000)+1000,
                    custId: custId,
                    date: new Date().toISOString().split('T')[0],
                    total: parseFloat(grand),
                    status: "Pending",
                    fulfilled: false,
                    lines: [] // Would serialize table lines here
                };
                DB.orders.push(newOrder);
                
                // Add Invoice placeholder
                DB.invoices.push({
                    id: "INV-"+newOrder.id,
                    orderId: "ORD-"+newOrder.id,
                    custId: custId,
                    amount: parseFloat(grand),
                    due: "2025-10-30",
                    status: "Unpaid"
                });

                document.getElementById('modal-order').classList.remove('open');
                Utils.toast("Order " + newOrder.id + " Created.");
                Utils.log(`Order generated for ₹${grand}`);
                Router.navigate('orders');
            }
        };
        
        // System Actions
        const System = {
            Action: {
                quickOrder: () => {
                    Order.populateCust();
                    document.getElementById('ord-lines-table').querySelector('tbody').innerHTML = '';
                    Order.addLine(); // one empty line
                    document.getElementById('modal-order').classList.add('open');
                }
            }
        };

        // Accounting Module
        const Accounts = {
            render: () => {
                 const tbody = document.getElementById('invoice-table-body');
                 tbody.innerHTML = '';
                 DB.invoices.forEach(inv => {
                     const cust = DB.customers.find(c => c.id == inv.custId);
                     tbody.insertAdjacentHTML('beforeend', `
                        <tr>
                            <td>${inv.id}</td>
                            <td>${inv.orderId}</td>
                            <td>${cust?cust.name:'-'}</td>
                            <td>${Utils.fmtCurrency(inv.amount)}</td>
                            <td>${inv.due}</td>
                            <td>${inv.status}</td>
                            <td><button class="btn btn-sm btn-success">Record Pay</button></td>
                        </tr>
                     `);
                 });
            }
        }


        /* =========================================
           7. GOOGLE DRIVE API ADAPTER (SIMULATION)
           ========================================= */
        const DriveAPI = {
             isAuthenticated: false,
             initAuth: () => {
                 const logs = document.getElementById('drive-logs');
                 logs.innerHTML += "<div>> Authenticating with OAuth 2.0 (ClientId)...</div>";
                 
                 // Simulate loading time
                 document.querySelector('#drive-led').classList.add('syncing');
                 
                 setTimeout(() => {
                     DriveAPI.isAuthenticated = true;
                     document.querySelector('#drive-led').classList.remove('syncing');
                     document.querySelector('#drive-led').classList.add('connected');
                     document.getElementById('last-sync-time').innerText = "Last sync: Just now";
                     document.getElementById('btn-drive-auth').innerText = "Connected as user@gmail.com";
                     document.getElementById('btn-drive-auth').classList.replace('btn-secondary','btn-success');
                     logs.innerHTML += `<div style="color:green">> Success. Token Received. Scopes: drive.file</div>`;
                     Utils.toast("Google Drive Connected!");
                 }, 1500);
             },
             
             // Concept: Export the DB object as JSON and upload
             uploadDatabase: () => {
                 if(!DriveAPI.isAuthenticated) { alert("Please Connect Account first."); return; }
                 
                 const content = JSON.stringify(DB, null, 2);
                 const fileMetadata = {
                    'name': 'HimalayanERP_Backup_' + new Date().toISOString() + '.json',
                    'mimeType': 'application/json'
                 };
                 
                 const logs = document.getElementById('drive-logs');
                 logs.innerHTML += `<div>> Preparing backup payload (${content.length} bytes)...</div>`;
                 
                 /* 
                  * REAL IMPLEMENTATION SNIPPET (If API key existed):
                  * const form = new FormData();
                  * form.append('metadata', new Blob([JSON.stringify(fileMetadata)], {type: 'application/json'}));
                  * form.append('file', new Blob([content], {type:'application/json'}));
                  * fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', ...);
                  */
                 
                 setTimeout(() => {
                     logs.innerHTML += `<div style="color:blue">> Upload Complete. File ID: 1xA...7f9</div>`;
                     Utils.toast("Database backed up to Drive.");
                 }, 1000);
             },

             generatePDF: (orderId) => {
                 // Simulation of PDF Generation + Upload
                 alert("Generating PDF invoice for "+orderId+" and uploading to 'Invoices' folder on Drive...");
                 // In real app: jsPDF -> Blob -> Drive API Multipart upload
             }
        };


        /* =========================================
           INITIALIZATION
           ========================================= */
        window.addEventListener('DOMContentLoaded', () => {
            // Seeding some dummy history
            DB.orders.push({id: 1001, custId: 101, date: "2025-10-10", total: 4800, status: "Delivered", fulfilled:true });
            DB.orders.push({id: 1002, custId: 103, date: "2025-10-11", total: 75000, status: "Paid", fulfilled:true });
            
            DB.invoices.push({ id:"INV-1001", orderId:"ORD-1001", custId:101, amount:4800, due:"2025-10-20", status:"Paid" });

            // Initialize Router
            Router.init();

            // Load initial view stats
            document.getElementById('dashboard-notifs').innerHTML += `<li>System loaded. Mock DB ready.</li>`;
            Order.renderHistory(); 

            // Time updater
            setInterval(() => {
                if(Math.random() > 0.95) {
                    // Simulate Random Event
                    Utils.log("New Lead from Website Form");
                }
            }, 10000);
        });

    </script>
</body>
</html>
